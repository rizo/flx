# Atoms
a
    a


# Operators
# +
#     +
# -->
#     -->
# (++)
#     ((_) ++)
# (+, #, @, !, -)
# .
# ..
# ...

# Blocks
(a)
    ((_) a)
{a}
    ({_} a)
[a]
    ([_] a)


# Seq with delim
a,
    (, a)
a,b
    (, a b)
a,b,
    (, a b)
a,b,c
    (, a b c)
a,b,c,
    (, a b c)
(a,)
    ((_) (, a))
(a,b)
    ((_) (, a b))
(a,b,)
    ((_) (, a b))
(a,b,c)
    ((_) (, a b c))
(a,b,c,)
    ((_) (, a b c))
# , , ,
# a, ,
# , a,
# a, , b,

a, b + 1
    (, a (_+_ b 1))

a, b, -1
    (, a b (-_ 1))

1; 2; 3, a
    (; 1 2 (, 3 a))

a, 1; b, 2; c, 3
    (; (, a 1) (, b 2) (, c 3))


# Delim seq + block

{a, b, c}
    ({_} (, a b c))

(a, b, c,)
    ((_) (, a b c))

()
    ((_) ())
{}
    ({_} ())
[]
    ([_] ())

# {;}
# {,}
{.}
    ({_} .)


# Infix operators

-a
    (-_ a)

- a
    (-_ a)

- a + b
    (-_ (_+_ a b))

- a + -b
    (-_ (_+_ a (-_ b)))


# Infix operators

a+b
    (_+_ a b)

a-b
    (_-_ a b)

a+b+c
    (_+_ (_+_ a b) c)

a-b*c
    (_-_ a (_*_ b c))

a*b-c
    (_-_ (_*_ a b) c)

a: b
    (_:_ a b)

a : b : c
    (_:_ a (_:_ b c))

a + b + c
    (_+_ (_+_ a b) c)

a: 1 + 2
    (_:_ a (_+_ 1 2))

a = 2 - 3
    (_=_ a (_-_ 2 3))

a.b
    (. a b)

a.b.c
    (. a b c)

a.b.c.
    error: <input>: line 1: col 6: unexpected end of input

a 1 . b 2 3 . c 4
    (_ a (. 1 b) 2 (. 3 c) 4)

a a.b.c 1 2 3
    (_ a (. a b c) 1 2 3)

a -> b -> c -> d
    (_->_ a (_->_ b (_->_ c d)))

{ a | b | c }
    ({_} (| a b c))

{ | a | b | c }
    ({_} (| a b c))

a = a = a
    (_=_ a (_=_ a a))


# Juxtaposition
a b c
    (_ a b c)

(a b c)
    ((_) (_ a b c))

a b (c 1 2)
    (_ a b ((_) (_ c 1 2)))

a b (c 1 2) d
    (_ a b ((_) (_ c 1 2)) d)

a b | c d | 1 2
    (| (_ a b) (_ c d) (_ 1 2))

a b c . d
    (_ a b (. c d))


# Postfix operators

a!
    (_! a)

a!, b
    (, (_! a) b)

(a)!
    (_! ((_) a))

(a!)!
    (_! ((_) (_! a)))

# a! | b!
# a! + b!

a.b.c!
    (_! (. a b c))

# a! +

# a! + a
#     (_+_ (_! a) (_! a))


# Block with operators
(a + b)
    ((_) (_+_ a b))
(a + b * c)
    ((_) (_+_ a (_*_ b c)))
a + [b * c]
    (_+_ a ([_] (_*_ b c)))
({a + b} * c)
    ((_) (_*_ ({_} (_+_ a b)) c))

# a,b!

# Delimited seq with operators
a, b + c
    (, a (_+_ b c))

a - b, c
    (, (_-_ a b) c)

a - b, c * d
    (, (_-_ a b) (_*_ c d))


# Seq

a b c
    (_ a b c)

a b c + 1
    (_+_ (_ a b c) 1)

1 - a b c
    (_-_ 1 (_ a b c))

1 + a b c * 2
    (_+_ 1 (_*_ (_ a b c) 2))

1 * a b c + 2
    (_+_ (_*_ 1 (_ a b c)) 2)


# Errors

# TODO: Show where the paren was opened.
(a
    error: <input>: line 1: col 2: end of input when expecting `)`

(((a))
    error: <input>: line 1: col 6: end of input when expecting `)`

)
    error: <input>: line 1: col 1: invalid token: `)`
a)
    error: <input>: line 1: col 1: unexpected token: `)`

(a))
    error: <input>: line 1: col 3: unexpected token: `)`

a b c)
    error: <input>: line 1: col 5: unexpected token: `)`


# Strings

""
    ""

"a"
    "a"

"hello world!"
    "hello world!"

"hello \"world\"!"
    "hello \"world\"!"

"literal escape sequences: \" \' \ \\ \$"
    "literal escape sequences: \" '  \\ $"

"special escape seqs: \n \r \t \b"
    "special escape seqs: \n \r \t \b"

"a", "bb", "ccc"
    (, "a" "bb" "ccc")

# Templates

"aaa ${1}"
    ($ "aaa " 1 "")

"aaa ${1} bbb"
    ($ "aaa " 1 " bbb")

"${1} aaa"
    ($ "" 1 " aaa")

"aaa ${1} bbb ${2}"
    ($ "aaa " 1 " bbb " 2 "")

"aaa ${1} bbb ${2} ccc"
    ($ "aaa " 1 " bbb " 2 " ccc")

"hello ${a b c}"
    ($ "hello " (_ a b c) "")

"hello ${a b c} world"
    ($ "hello " (_ a b c) " world")


# Templates: edge cases

"${}"
    ($ "" "")

"X${}"
    ($ "X" "")

"${}X"
    ($ "" "X")

"${""}"
    ($ "" "" "")

"${"${""}"}"
    ($ "" ($ "" "" "") "")

"aaa ${1}${2} bbb"
    ($ "aaa " 1 "" 2 " bbb")

"aaa ${b "xxx" 1} ccc"
    ($ "aaa " (_ b "xxx" 1) " ccc")

"aaa ${b "xxx ${1} yyy" 1} ccc"
    ($ "aaa " (_ b ($ "xxx " 1 " yyy") 1) " ccc")


"aaa ${ "xxx" "y${2}y" "zzz"} ccc ${2}"
    ($ "aaa " (_ "xxx" ($ "y" 2 "y") "zzz") " ccc " 2 "")

"aaaa ${
    error: <input>: line 1: col 8: unexpected end of input

"aaaa ${1}
    error: <input>: line 1: col 10: unterminated template string

"hello ${a "
    error: <input>: line 1: col 12: unterminated string literal

a "" "xxx ${1 b}" c d "yy ${2 "www ${c d ""}"} zz"
    (_ a "" ($ "xxx " (_ 1 b) "") c d
       ($ "yy " (_ 2 ($ "www " (_ c d "") "")) " zz"))

"aaa ${2 + 2} } bbb"
    ($ "aaa " (_+_ 2 2) " } bbb")

"aaa ${ (1) } bbb"
    ($ "aaa " ((_) 1) " bbb")

"aaa ${ {1}             } bbb"
    ($ "aaa " ({_} 1) " bbb")

"aaa ${ {{{1}}} } bbb"
    ($ "aaa " ({_} ({_} ({_} 1))) " bbb")


"aaa ${ {1} 2 {{3}} } bbb"
    ($ "aaa " (_ ({_} 1) 2 ({_} ({_} 3))) " bbb")

"${{}}"
    ($ "" ({_} ()) "")

"X${ {"x"} }Y"
    ($ "X" ({_} "x") "Y")

"X1${    {1}    }X2${    2    }X3${    {{"Y"}}    }X4${    {"Z1${    3    }Z2"}    }X4"
    ($ "X1"
         ({_} 1)
         "X2"
         2
         "X3"
         ({_} ({_} "Y"))
         "X4"
         ({_} ($ "Z1" 3 "Z2"))
         "X4")


"X1${ { X2 "${1}Y2" } }Y2"
    ($ "X1" ({_} (_ X2 ($ "" 1 "Y2"))) "Y2")
"X1${ { X2"${1}Y2" ""} }Y2"
    ($ "X1" ({_} (_ X2 ($ "" 1 "Y2") "")) "Y2")
"X1${ {"" X2"${1}Y2"} }Y2"
    ($ "X1" ({_} (_ "" X2 ($ "" 1 "Y2"))) "Y2")
"X1${    { "Y1${    {1}    }Y2" }    }X2"
    ($ "X1" ({_} ($ "Y1" ({_} 1) "Y2")) "X2")


{{}}
    ({_} ({_} ()))

{{{{}}}}
    ({_} ({_} ({_} ({_} ()))))

{{{{2}}}}
    ({_} ({_} ({_} ({_} 2))))


# Not templates
"$"
    "$"
"a$"
    "a$"
"$a"
    "$a"
"a$b"
    "a$b"

"X1${}X2${}X3"
{ "${}" }

"X1${1}X2${{2}}X3"
    ($ "X1" 1 "X2" ({_} 2) "X3")
